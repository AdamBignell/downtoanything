
<div><span class="h1">Latest Challenges <%= link_to 'Create Challenge', new_challenge_path, class: "btn btn-secondary" %></span></div>


<div class="card-deck-wrapper mt-2">
  <div class="card-deck">
  <% @topchallenges = @challenges.sort_by { |chall| chall.score}.reverse! %>
  <% @topchallenges.each do |challenge| %>
      <div class="card challenge" data-url="<%= challenge_path(challenge)%>">
          <div class="card-block">
            <div class="card-title mb-0"><span class="h2"><%= challenge.name %></span></div>
            <span class="h6">
                <span>By: <%= challenge.us_chal_interactions.where(:interaction => "created").first.user.username %></span>
                <span class="ml-1">Total score: <%= challenge.score%></span>
            </span>
            <p class="card-text mt-1"><i><%= challenge.description %></i></p>
            <hr>
            <% @subs = challenge.submissions.sort_by { |sub| sub.score}.reverse! %>
            <% if not @subs.blank? %>
              <% @topsub = @subs[0] %>
                Top Submission: <%= @topsub.user_interactions.where(:interaction => "created").first.user.username %>
                Score: <%= @topsub.score %>
            <% else %>
              <p class="lead"> There are no submissions to this challenge yet! </p>
            <% end %>
          </div>
        </div>
    <% end %>
    </div>
    </div>
    <div class="floatright">
      <%= form_tag(challenges_path, :method => "get", id: "search-form") do %>
      <%= text_field_tag :search, params[:search], placeholder: "Search Challenges" %>
      <%= submit_tag "Search!", class: "btn-outline-info" %>
    </div>
  </div>
</div>

<div class="row">
<div class="col-xs-12">

<% end %>
</div>
</div>

<script>
  $('.challenge').click(function(){
    window.location.href = $(this).data('url');
  });
   $(".challenge a").click(function(e) {
   //prevent going to view when click on link inside card
   e.stopPropagation();
  });
</script>
